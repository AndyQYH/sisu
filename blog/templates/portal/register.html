{% load staticfiles %}
{% load socialaccount %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Meta Tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Sisu VR Inc">
        
        <!-- Title -->
        {% include 'components/portal_tab_title.html' %}

        <!-- Styles -->
        <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'portal/plugins/bootstrap/css/bootstrap.min.css' %}" />
        <link rel="stylesheet" href="{% static 'portal/plugins/font-awesome/css/font-awesome.min.css' %}" />
        <link rel="stylesheet" href="{% static 'portal/plugins/icomoon/style.css' %}" />
        <link rel="stylesheet" href="{% static 'portal/plugins/uniform/css/default.css' %}" />
        <link rel="stylesheet" href="{% static 'portal/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css' %}" />

        <!-- Theme Styles -->
        <link rel="stylesheet" href="{% static 'portal/css/space.min.css' %}" />
        <link rel="stylesheet" href="{% static 'portal/css/custom.css' %}" />
<style>
    tfoot {
    display: table-header-group !important;
}
</style>
    </head>
    <body>
        
        <!-- Page Container -->
        <div class="page-container">

            <!-- Page Sidebar Start -->
            {% if player.admin %}
                {% include 'components/portal_sidebar_admin.html' %}
            {% elif player.supervisor %}
                {% include 'components/portal_sidebar_supervisor.html' %}
            {% else %}
                {% include 'components/portal_sidebar_employee.html' %}
            {% endif %}
            <!-- Page Sidebar End -->

            <!-- Page Content Start -->
            <div class="page-content">
                <!-- Page Sidebar / Navigation Elements Start -->
                <div class="page-header">
                    <!-- Collapsed / Mobile Navigation Bar Start -->
                    {% include 'components/portal_mobilenav.html' %}
                    <!-- Collapsed / Mobile Navigation Bar End -->
                </div>
                <!-- Page Sidebar / Navigation Elements End -->

                <!-- Page Inner Start -->
                <div class="page-inner">
                    <!-- Page Top Bar Start -->
                    <div class="page-title">
                        <h2 id="registration-header">Register Employees</h2>
                        <hr>
                    </div>
                    <!-- Page Top Bar End -->
                    
                    <!-- Main Content Start -->
                    <div id="registration-step-1">
                        <div class="row">
                            <p>Select the team you would like to register employees for.</p>
                            <p>You can create teams by clicking “Add Team” below, or <u id="skip-link" style="cursor: pointer;">skip this step and assign team later</u>.</p>
                        </div>
                        <button id="add-team-btn" class="btn btn-sisu-primary" style="float: right; margin-right: 25px; width:120px;">Add Team</button>
                        <br/><br/><br/>

                        {% for team, employee_list in teams.items %}
                            <div class="col-md-12" style="margin-bottom: 25px;">
                                <div class="table-responsive">
                                    <table class="display table" style="margin-bottom: 0;">
                                        <thead class="tbl-sisu-header-normal-case">
                                            <tr>
                                                <th class="col-md-4" style="text-transform:uppercase; color: #494949; vertical-align: middle;">
                                                    <div class="triangle-right" team="{{team.id}}"></div>{% if team != "unassigned" %}{{team.team_name}}{% else %}UNASSIGNED{% endif %}</th>
                                                <th class="col-md-2" style="text-align: right; vertical-align: middle;">{% if team != "unassigned" %}{{team.leader}}{% else %}None{% endif %}</th>
                                                <th class="col-md-3" style="text-align: right; color: #494949; vertical-align: middle;">{{ employee_list|length }} {% if employee_list|length > 1 %} people {% else %} person {% endif %}</th>
                                                <th class="col-md-3" style="text-align: right;">
                                                    {% if team != "unassigned" %}
                                                        <button class="btn btn-sisu-primary register-btn" style="width:120px; background-color: #FFB45B;" team_id="{{team.id}}" team_name="{{team.team_name}}">Register</button>
                                                    {% else %}
                                                        <button id="unassigned-regi-btn" class="btn btn-sisu-primary register-btn" style="width:120px; background-color: #FFB45B;" team_id="{{team.id}}" team_name="UNASSIGNED">Register</button>
                                                    {% endif %}
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                    <table id="team-{{team.id}}" class="display table team-table" style="width: 100%; cellspacing: 0;" hidden>
                                        <thead class="tbl-sisu-header">
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Registration Type</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for employee in employee_list %}
                                                <tr>
                                                    <td>{{ employee.full_name }}</td>
                                                    <td>{{ employee.email }}</td>
                                                    <td>{% if employee.supervisor is True %} Supervisor {% else %} Non-supervisor {% endif %}</td>
                                                    
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>  
                                </div>
                            </div>
                        {% endfor %}

                        <!-- add team modal start -->
                        {% include 'components/add-team-modal.html' with pk='register' %}
                        <!-- add team modal end -->
                    </div>
                    <div id="registration-step-2" hidden>
                        <div class="row">
                            <p>Enter each employee's email address into their corresponding textbox below (VR or Desktop, Non-supervisor, or Supervisor).</p>
                            <p>When you are finished entering each employee's email into the appropriate field, click "<a style="color: #9F3688" href="#send-reg-emails">Register Employees and Send Emails</a>" at the bottom of this page.</p>
                            <hr>
                            <br/>
                            <button class="btn btn-sisu-primary registration-back" type="">Back to Previous Step</button>

                                <!-- NOTE - the input of "type=email" and data-role="tagsinput" was causing issues - need to investigate further -->
                                <div hidden>
                                    <textarea id="team" name="team"></textarea>
                                    <textarea id="team-id" name="team-id"></textarea>
                                </div>
                                <div>
                                    <h3 class="sisu-h3" style="padding-top:26px; padding-bottom: 10px;">1. VR - Non-supervisor</h3>
                                    <p>Add each employee's email address separated by commas.</p>
                                    <!-- <input type="email" data-role="tagsinput" class="form-control" name="vr-nonsupervisor"> -->
                                    <textarea id="vr-nonsupervisor" class="form-control" name="vr-nonsupervisor"></textarea>
                                    <!-- hello@email.com, robert@sisuvr.com, test@sisurvr.com -->
                                </div>
                                <div>
                                    <h3 class="sisu-h3" style="padding-top:26px; padding-bottom: 10px;">2. VR - Supervisor</h3>
                                    <p>Add each employee's email address separated by commas.</p>
                                    <!-- <input type="email" data-role="tagsinput" class="form-control" name="vr-supervisor"> -->
                                    <textarea id="vr-supervisor" class="form-control" name="vr-supervisor"></textarea>
                                </div>
                                <div>
                                    <h3 class="sisu-h3" style="padding-top:26px; padding-bottom: 10px;">3. Desktop - Non-supervisor</h3>
                                    <p>Add each employee's email address separated by commas.</p>
                                    <!-- <input type="email" data-role="tagsinput" class="form-control" name="desktop-nonsupervisor"> -->
                                    <textarea id="desktop-nonsupervisor" class="form-control" name="desktop-nonsupervisor"></textarea>
                                </div>
                                <div>
                                    <h3 class="sisu-h3" style="padding-top:26px; padding-bottom: 10px;">4. Desktop - Supervisor</h3>
                                    <p>Add each employee's email address separated by commas.</p>
                                    <!-- <input type="email" data-role="tagsinput" class="form-control" name="desktop-supervisor"> -->
                                    <textarea id="desktop-supervisor" class="form-control" name="desktop-supervisor"></textarea>
                                </div>
                                <div style="padding-bottom: 120px" class="">
                                    <br>
                                    <button name="send-reg-emails" class="btn btn-sisu-primary bnt-submit" type="">
                                        Send Registration Emails
                                    </button>

                                    <div style="width: 350px; margin-top:12px">
                                    
                                    <div id="alert-emails-sent" class="alert alert-success alert-dismissible hidden" role="alert">
                                    Emails successfully sent.
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
                                </div>

                                    </div>
                                </div>

                        </div>
                    </div>
                    <!-- Main Content End -->

                    <!-- Page Footer Start -->
                    {% include 'components/portal_footer.html' %}
                    <!-- Page Footer End -->
                </div>
                <!-- Page Inner End -->
            </div>
            <!-- Page Content End -->

        </div>
        <!-- /Page Content -->
        
        
        <!-- Scripts -->
        <script src="{% static 'portal/plugins/jquery/jquery-3.1.0.min.js' %}"></script>
        <script src="{% static 'portal/plugins/bootstrap/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'portal/plugins/jquery-slimscroll/jquery.slimscroll.min.js' %}"></script>
        <script src="{% static 'portal/plugins/uniform/js/jquery.uniform.standalone.js' %}"></script>
        <script src="{% static 'portal/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js' %}"></script>
        <script src="{% static 'portal/js/space.min.js' %}"></script>
        <script src="{% static 'portal/js/scripts.js' %}"></script>
        <script>
                let vr_nonsupervisor = $('#vr-nonsupervisor').val()
                let vr_supervisor = $('#vr-supervisor').val()
                let desktop_nonsupervisor = $('#desktop-nonsupervisor').val()
                let desktop_supervisor = $('#desktop-supervisor').val();

                {% comment %} $('#vr-nonsupervisor').val("vr-nonsupervisor@sisuvr.com"); {% endcomment %}
                {% comment %} $('#vr-supervisor').val("vr-supervisor@gmail.com"); {% endcomment %}
                {% comment %} $('#desktop-nonsupervisor').val("desktop-nonsupervisor@gmail.com"); {% endcomment %}
                {% comment %} $('#desktop-supervisor').val("desktop-supervisor@gmail.com"); {% endcomment %}
        

            $(".bnt-submit").click(function() {

                console.log('FORM CLCIKED!')
                let team_name = $('#team').val()
                let team_id = $('#team-id').val()
                let vr_nonsupervisor = $('#vr-nonsupervisor').val()
                let vr_supervisor = $('#vr-supervisor').val()
                let desktop_nonsupervisor = $('#desktop-nonsupervisor').val()
                let desktop_supervisor = $('#desktop-supervisor').val();

                console.log('vr_nonsupervisor = ', vr_nonsupervisor)
                console.log('team_name = ', team_name)

                $.ajax({
                    url: '',
                    type: 'GET',
                    data: {
                        team_id: team_id,
                        team_name: team_name,
                        vr_nonsupervisor: vr_nonsupervisor,
                        vr_supervisor: vr_supervisor,
                        desktop_nonsupervisor: desktop_nonsupervisor,
                        desktop_supervisor: desktop_supervisor
                    },
                    success: function(response){
                        console.log('RESPONSE', response);
                        $('#vr-nonsupervisor').val("");
                        $('#vr-supervisor').val("");
                        $('#desktop-nonsupervisor').val("");
                        $('#desktop-supervisor').val("");

                        if (response['failure_list'].length) {
                            $('#alert-emails-sent').text('Invalid email addresses: ' + response['failure_list'].join(', '));
                        } else {
                            $('#alert-emails-sent').text('Emails successfully sent.');
                        }
                        $('#alert-emails-sent').removeClass('hidden');
                    }
                })


            });
        </script>
    </body>
</html>